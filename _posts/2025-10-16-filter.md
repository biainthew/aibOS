---
layout: post
title: "Filter"
date: 2024-10-31
categories: [general]
tags: [Java]
---


Java에서 Filter는 요청과 응답에 대해 전처리(pre-processing)나 후처리(post-processing)를 수행하는 데 사용된다. 필터는 주로 인증, 로깅, 인코딩, CORS 설정 등 공통된 처리가 필요할 때 사용되며 요청이 특정 서블릿이나 리소스에 도달하기 전에 원하는 작업을 수행하고 응답을 전송하기 전에도 필요한 작업을 수행할 수 있다


### 특징

1. 필터는 클라이언트의 요청이 서블릿에 도달하기 전에 요청을 처리하거나 서블릿의 응답이 클라이언트에게 전송되기 전에 응답을 처리할 수 있다
2. 여러 필터를 연속적으로 사용할 수 있으며 요청이 각 필터를 통과하면서 처리된다
3. 특정 URL 패턴에 대해 필터를 설정할 수 있어 로그인 인증, 권한 검사, 공통 로깅 등과 같은 처리가 필요한 모든 URL에 필터를 적용할 수 있다

### 구현


javax.servlet.Filter 인터페이스를 구현해야 하며 다음 세 가지 메서드를 주로 사용한다

1. init(FilterConfig filterConfig) : 필터 초기화 시 호출되는 메서드로 필요한 초기화 작업을 수행한다
2. doFilter(ServletRequest request, ServletResponse response, FilterChain chain) : 요청이 필터를 통과할 때마다 호출되는 메서드로 요청을 처리하고 필요에 따라 다음 필터나 서블릿으로 요청을 전달할 수 있다
3. destroy() : 필터가 종료될 때 호출되며 자원 해제를 위해 사용된다

**예제**


요청을 받아서 로그를 기록하고 사용자 인증을 확인하는 필터를 작성한다고 가정해 봤을 때


```java
import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletRequest;
import java.io.IOException;

public class LoggingAndAuthenticationFilter implements Filter {

	@Override
	public void init(FilterConfig filterConfig) throws ServletException {
		System.out.println("LoggingAndAuthenticaationFilter 초기화됨");
	}
	
	@Override
	public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
		HttpServletRequest httpRequest = (HttpServletRequest) request;
		System.out.println("요청 URL: " + httpRequest.getRequestURL());
		
		// 인증 확인 (세션에 "user" 속성이 있는지로 확인)
		if(httpRequest.getSession().getAttribute("user")!= null) {
			// 인증된 사용자, 요청 계속 진행
			chain.doFilter(request, response);
			// 인증되지 않은 사용자, 접근 불가
		} else {
			response.getWriter().write("인증이 필요합니다.")
		}
	}
	
	@Override
	public void destroy() {
		System.out.println("LoggingAndAuthenticationFilter 종료됨");
	}
}
```


### 설정


필터를 사용하려면 웹 어플리케이션의 web.xml 파일에 필터를 등록하거나 자바 어노테이션 @WebFilter 를 사용할 수 있다


**XML 설정 방식 (web.xml)**


```xml
<filter>
	<filter-name>LoggingAndAuthenticationFilter</filter-name>
	<filter-class>com.example.LoggingAndAuthenticationFilter</filter-class>
</filter>

<filter-mapping>
	<filter-name>LoggingAndAuthenticationFilter</filter-name>
	<url-pattern>/*</url-pattern>
</filter-mapping>
```


**어노테이션 설정 방식**


```java
import javax.servlet.annotation.WebFilter;

@WebFilter("/*")
public class LoggingAndAuthenticationFilter implements Filter {
	// 필터 구현
}
```


### 다양한 용도


필터는 여러 용도로 사용될 수 있으며 주로 다음과 같은 작업을 할 때 사용된다

1. **인증 및 권한 확인** : 로그인 여부와 권한을 확인하여 요청을 제한한다
2. **로깅** : 요청 및 응답을 로깅해 기록을 남긴다
3. **응답 캐싱** : 응답을 캐싱해 클라이언트의 요청을 효율적으로 처리한다
4. **데이터 압축** : 응답 데이터를 압축해 전송 효율을 높인다
5. **CORS 설정** : 다른 도메인에서의 요청을 허용하도록 설정한다

### 필터 체인 (Filter Chain)


필터 체인은 여러 필터가 연결되어 있는 구조를 의미한다 여러 필터가 설정되어 있으면 각 필터는 chain.doFilter() 를 호출하여 다음 필터로 요청을 전달한다 모든 필터가 처리된 후에는 서블릿이 호출되어 실제 요청을 처리하게 된다


필터는 다양한 용도로 사용되어 공통 로직을 중앙에서 관리할 수 있고 이를 통해 코드 재사용성 및 유지보수성을 높일 수 있다


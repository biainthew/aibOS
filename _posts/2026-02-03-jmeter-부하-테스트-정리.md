---
layout: post
title: "JMeter 부하 테스트 정리"
date: 2026-02-02
categories: [general]
tags: [Infra]
excerpt_separator: ""
---



### JMeter 설치

- Apache JMeter 5.6.3 다운로드
- Java 8 이상 필요

### 환경변수 설정 (선택)


CLI에서 편하게 쓰려면 환경변수 설정해두기


{% raw %}
```shell
setx JMETER_HOME "C:\apache-jmeter-5.6.3"
setx PATH "%PATH%;%JMETER_HOME%\bin"
```
{% endraw %}


실행 확인


{% raw %}
```shell
jmeter -v
```
{% endraw %}


### 테스트 파일 구조


{% raw %}
```plain text
C:\jmeter_tests\
├── users.csv                          # 사용자 계정
├── admins.csv                         # 관리자 계정
├── update_jmeter_cookies_v2.py        # 쿠키 일괄 변경
├── test_edu_admin_variable.jmx        # 교육 관리자 (40개 API)
├── test_edu_user_variable.jmx         # 교육 사용자 (31개 API)
├── test_portal_admin_variable.jmx     # 대표 관리자 (48개 API)
└── test_portal_user_variable.jmx      # 대표 사용자 (26개 API)
```
{% endraw %}


### Thread Properties 변수화


원래는 JMX 파일에 값이 하드코딩되어 있었음


{% raw %}
```xml
<intProp name="ThreadGroup.num_threads">2</intProp>
<intProp name="ThreadGroup.ramp_time">1</intProp>
<stringProp name="LoopController.loops">1</stringProp>
```
{% endraw %}


변수로 바꿔서 CLI에서 값을 넘겨줄 수 있게 수정


{% raw %}
```xml
<stringProp name="ThreadGroup.num_threads">${__P(threads,2)}</stringProp>
<stringProp name="ThreadGroup.ramp_time">${__P(rampup,1)}</stringProp>
<stringProp name="LoopController.loops">${__P(loops,1)}</stringProp>
```
{% endraw %}


이렇게 하면 CLI에서 `-Jthreads=100` 형태로 값 변경 가능


### GUI 테스트 실행


**기본 실행**


{% raw %}
```shell
C:\apache-jmeter-5.6.3\bin\jmeter.bat
```
{% endraw %}


**테스트 파일 열기**


File → Open → .jmx 파일 선택


**Thread Properties 설정**

- Number of Threads: 동시 사용자 수
- Ramp-up Period: 증가 시간 (초)
- Loop Count: 반복 횟수

**결과 확인**

- View Results Tree: 개별 요청 상세
- View Results in Table: 요청 목록, 응답시간
- Summary Report: 통계 요약

### CLI 테스트 실행


**기본 명령어**


{% raw %}
```shell
jmeter -n -t [파일.jmx] -l [결과.jtl] -Jthreads=[수] -Jrampup=[초] -Jloops=[횟수]
```
{% endraw %}


**옵션 설명**

- `n`: CLI 모드
- `t`: 테스트 파일
- `l`: 결과 로그 파일
- `e`: HTML 리포트 생성
- `o`: 리포트 폴더
- `Jthreads`: 동시 사용자 수
- `Jrampup`: Ramp-up Period
- `Jloops`: Loop Count

**실행 예시**


{% raw %}
```shell
cd C:\jmeter_tests

# 기본 실행
jmeter -n -t test_edu_admin_variable.jmx -l results.jtl -Jthreads=50 -Jrampup=10 -Jloops=10

# HTML 리포트 생성
jmeter -n -t test_edu_admin_variable.jmx -l results.jtl -e -o html_report -Jthreads=50 -Jrampup=10 -Jloops=20
```
{% endraw %}


**리포트 열기**


{% raw %}
```shell
start html_report\index.html
```
{% endraw %}


---


### 부하 테스트 시나리오


**1. 기본 부하 (Low Load)**


50명, 1초, 5회 반복 → 초당 250 요청


{% raw %}
```shell
jmeter -n -t test_edu_admin_variable.jmx -l low_results.jtl -e -o low_report -Jthreads=50 -Jrampup=1 -Jloops=5
```
{% endraw %}


**2. 중간 부하 (Medium Load)**


100명, 1초, 10회 반복 → 초당 1000 요청


{% raw %}
```shell
jmeter -n -t test_edu_admin_variable.jmx -l medium_results.jtl -e -o medium_report -Jthreads=100 -Jrampup=1 -Jloops=10
```
{% endraw %}


**3. 고부하 (High Load)**


200명, 1초, 15회 반복 → 초당 3000 요청


{% raw %}
```shell
jmeter -n -t test_edu_admin_variable.jmx -l high_results.jtl -e -o high_report -Jthreads=200 -Jrampup=1 -Jloops=15
```
{% endraw %}


**4. 극한 부하 (Stress Test)**


500명, 1초, 20회 반복 → 초당 10000 요청


{% raw %}
```shell
set JVM_ARGS=-Xms2g -Xmx8g
jmeter -n -t test_edu_admin_variable.jmx -l stress_results.jtl -e -o stress_report -Jthreads=500 -Jrampup=1 -Jloops=20
```
{% endraw %}


## 관리자 쿠키 변경


관리자 테스트는 인증이 필요해서 쿠키 업데이트 필요함


**스크립트 수정**


update_jmeter_cookies_v2.py 파일 열어서 쿠키 값 입력


**교육 시스템**


{% raw %}
```python
EDU_ADMIN_COOKIES = {
    "NIBP_EDU_SESSION": "실제_세션_값",
    "_nibp-edu_sid": "실제_sid_값",
    "__Host-nibp-edu-accessToken": "실제_액세스_토큰",
    "__Host-nibp-edu-refreshToken": "실제_리프레시_토큰"
}
```
{% endraw %}


**대표 홈페이지**


{% raw %}
```python
PORTAL_ADMIN_COOKIES = {
    "NIBP_SESSION": "실제_세션_값",
    "_nibp_sid": "실제_sid_값",
    "__Host-nibp-accessToken": "실제_액세스_토큰",
    "__Host-nibp-refreshToken": "실제_리프레시_토큰"
}
```
{% endraw %}


**실행**


{% raw %}
```shell
cd C:\jmeter_tests
python update_jmeter_cookies_v2.py
```
{% endraw %}


파일 선택

- `all`: 모든 관리자 파일 일괄 변경
- `1` 또는 `3`: 개별 선택

**변경 방식**

- 원본 파일: .backup으로 백업
- 변경된 파일: 원본 파일명 그대로 덮어쓰기
- 바로 사용 가능

### 결과 분석


**주요 지표**

- APDEX: 사용자 만족도 (1.0이 완벽, 0.5 이상이면 양호)
- Total: 총 요청 수
- Success: 성공 요청 수
- Error %: 에러 비율
- Average: 평균 응답 시간
- 90th Percentile: 90% 사용자가 경험한 최대 응답시간
- Throughput: 초당 처리량 (requests/sec)

**성능 기준**


평균 응답시간

- 우수: 1초 미만
- 양호: 1-3초
- 개선 필요: 3초 이상

에러율

- 우수: 0.1% 미만
- 양호: 0.1-1%
- 개선 필요: 1% 이상

### 배치 스크립트 (test_all.bat)


4개 테스트 한번에 실행


{% raw %}
```plain text
@echo off
echo [1/4] 교육 관리자 테스트
jmeter -n -t test_edu_admin_variable.jmx -l edu_admin_results.jtl -e -o edu_admin_report -Jthreads=20 -Jrampup=5 -Jloops=10

echo [2/4] 교육 사용자 테스트
jmeter -n -t test_edu_user_variable.jmx -l edu_user_results.jtl -e -o edu_user_report -Jthreads=20 -Jrampup=5 -Jloops=10

echo [3/4] 대표 관리자 테스트
jmeter -n -t test_portal_admin_variable.jmx -l portal_admin_results.jtl -e -o portal_admin_report -Jthreads=20 -Jrampup=5 -Jloops=10

echo [4/4] 대표 사용자 테스트
jmeter -n -t test_portal_user_variable.jmx -l portal_user_results.jtl -e -o portal_user_report -Jthreads=20 -Jrampup=5 -Jloops=10

echo 완료
pause
```
{% endraw %}


### 문제 해결


**CSV 파일 에러**


File not found 뜨면 JMeter GUI에서 CSV Data Set Config 경로 수정


**쿠키 만료**


401 Unauthorized 뜨면 update_jmeter_cookies_v2.py로 쿠키 재설정


**리포트 폴더 에러**


Cannot create report folder 뜨면


{% raw %}
```shell
rmdir /s /q html_report
```
{% endraw %}


**Windows 줄바꿈 에러**


Unknown arg 에러는 명령어를 한 줄로 작성
Windows CMD에서 `\` 줄바꿈 안 됨


### 정리

1. Thread Properties를 변수화해서 CLI로 값 조절 가능
2. GUI는 간단한 테스트용, CLI는 본격 부하 테스트용
3. 관리자 테스트는 쿠키 업데이트 필수
4. HTML 리포트로 결과 분석
5. 부하 테스트는 단계적으로 (Low → Medium → High → Stress)

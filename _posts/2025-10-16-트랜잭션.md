---
layout: post
title: "트랜잭션"
date: 2024-10-02
categories: [general]
tags: [Java]
excerpt_separator: ""
---



### 특성

1. 원자성(Atomicity)
    1. 트랜잭션에 포함된 작업들은 모두 하나의 단위로 처리되어야 한다
    2. 트랜잭션 내의 작업이 모두 성공하거나 하나라도 실패하면 트랜잭션이 전체적으로 실패한 것으로 간주하고 롤백
    3. ex) 은행 계좌 간의 송금에서 돈을 한 계좌에서 출금하고 다른 계좌에 입금하는 작업이 있다면 출금만 되거나 입금만 되는 상태가 되면 안된다 둘 다 성공해야 하며 하나라도 실패하면 작업이 모두 취소됨
2. 일관성(Consistency)
    1. 트랜잭션이 성공적으로 완료된 후 데이터베이스는 일관된 상태여야 한다
    2. 트랜잭션 전후의 데이터베이스는 항상 무결성 제약 조건을 만족해야 한다 ex) 외래 키, 고유 제약 조건 등
3. 고립성(Isolation)
    1. 동시에 실행되는 트랜잭션들이 서로 간섭하지 않도록 해야 한다
    2. 각 트랜잭션은 독립적으로 실행되며 다른 트랜잭션의 중간 작업 상태를 참조할 수 없다
    3. 하나의 트랜잭션이 완료되기 전까지는 다른 트랜잭션이 그 영향을 받지 않도록 고립
4. 지속성(Durability)
    1. 트랜잭션이 성공적으로 완료된 후에는 그 결과가 영구적으로 유지되어야 한다
    2. 시스템이 고장나거나 오류가 발생하더라도 트랜잭션이 커밋된 데이터는 손실되지 않도록 보장

### 과정

1. **BEGIN** : 트랜잭션 시작
2. **작업 수행** : 트랜잭션 내에서 여러 작업(INSERT, UPDATE, DELETE 등)이 수행
3. **COMMIT** : 트랜잭션 내의 모든 작업이 성공적으로 완료되면 트랜잭션을 COMMIT 하여 변경사항을 데이터베이스에 반영
4. **ROLLBACK** : 트랜잭션 내에서 오류가 발생하거나 명시적으로 작업을 취소할 경우 ROLLBACK 하여 트랜잭션 내의 모든 변경사항을 취소

    {% raw %}
```java
    @Service
    public class BankService {
    
        @Autowired
        private AccountRepository accountRepository;
    
        @Transactional
        public void transferMoney(Long fromAccountId, Long toAccountId, BigDecimal amount) {
            // 출금 작업
            Account fromAccount = accountRepository.findById(fromAccountId);
            fromAccount.withdraw(amount);
            
            // 입금 작업
            Account toAccount = accountRepository.findById(toAccountId);
            toAccount.deposit(amount);
        }
    }
    ```
{% endraw %}


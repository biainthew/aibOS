---
layout: post
title: "The more"
date: 2023-01-09
categories: [general]
tags: [Javascript/Jquery]
excerpt_separator: ""
---



스크롤 내리면 내용이 나타남, 통통 튀는 로딩 동그라미


json data fetch 로 받아옴 aync await 비동기적 방식 사용


{% raw %}
```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="./script.js" defer></script>
</head>
<body>
    <h1>My the more</h1>
    <div class="filter-container">
        <input type="text" id="filter" class="filter" placeholder="찾기...">
    </div>
    <div id="posts-container">
        <!-- <div class="post">
            <div class="number"></div>
            <div class="post-info">
                <div class="post-title"></div>
                <div class="post-body"></div>
            </div>
        </div> -->
    </div>
    <div class="loader">
        <div class="class"></div>
        <div class="class"></div>
        <div class="class"></div>
    </div>
</body>
</html>
```
{% endraw %}


{% raw %}
```css
*{margin: 0; padding: 0; box-sizing: border-box;}
body{background: rgb(189, 212, 255); display: flex; flex-direction: column; align-items: center; justify-content: center; padding-bottom: 100px; min-height: 100vh;}
h1{text-align: center; color: #fff;}
.filter-container{margin-top: 20px; width: 80vw; max-width: 800px;}
.filter{width: 100%; padding: 12px; border: none;}
.post{position: relative; background: rgb(160, 193, 255); box-shadow: 0 2px 4px rgba(0, 0, 0, .3); padding: 20px; border-radius: 3px; margin: 40px 0; display: flex; width: 80vw; max-width: 800px;}
.post .number{position: absolute; width: 40px; height: 40px; border-radius: 50%; background: #fff; top: -15px; left: -15px; color: rgb(160, 193, 255); display: flex; align-items: center; justify-content: center;}
.post-info{margin-left: 20px;}
.post-title{font-size: 20px; font-weight: bold;}
.post-body{margin: 15px 0 0; line-height: 1.3;}

.loader{display: flex; position: fixed; bottom: 50px; transition: .3s ease-in; opacity: 0;}
.loader.show{opacity: 1;}
.loader .class{width: 10px; height: 10px; border-radius: 50%; background: #fff; margin: 5px; animation: bounce .5s ease-in infinite;}
.loader .class:nth-of-type(2){animation-delay: .1s;}
.loader .class:nth-of-type(3){animation-delay: .2s;}

@keyframes bounce {
    0%{transform: translateY(0);}
    50%{transform: translateY(-10px);}
    100%{transform: translateY(0);}
}
```
{% endraw %}


{% raw %}
```javascript
const postsContainer = document.getElementById('posts-container');
const filter = document.getElementById('filter');
const loading = document.querySelector('.loader');

let limit = 5;
let page = 1;

// getPost() 내용 가져온 상태
async function getPost(){
    const res = await fetch(
        `https://jsonplaceholder.typicode.com/posts?_limit=${limit}&_page=${page}`
        //list(5)개 씩 보이고 page(1)페이지부터 보여줘
    );
    //res 라는 변수에 fetch 함수를 이용해 json data 담기
    const data = await res.json();
    // console.log(res)
    return data;
};
// showPosts() 내용이 다 보이는 상태
async function showPosts(){
    const posts = await getPost(); //비동기식 처리를 할 함수 앞에 await
    posts.forEach(post => { //posts 배열 을 post 매개변수 에 넣기 ?
        // console.log(posts) 배열
        console.log(post) /* 배열 */
        const postEl = document.createElement('div'); //postEl 안에 div 요소 만들어서 담음
        postEl.classList.add('post');
        postEl.innerHTML=
        `<div class="number">${post.id}</div>
        <div class="post-info">
            <div class="post-title">${post.title}</div>
            <div class="post-body">${post.body}</div>
        </div>`
        postsContainer.appendChild(postEl)
    });
};

// showLoading()
function showLoading(){
    loading.classList.add('show'); //class 줘서 보이게 하고
    setTimeout(() => { //1초 기다렸다가 실행
        loading.classList.remove('show');
        setTimeout(() => { //.3초 기다렸다가 실행
            page++; //다음 페이지로 넘기고
            showPosts(); //그 페이지 내용 보여주기
        }, 300);
    },1000)
}

showPosts();
window.addEventListener('scroll',function(){
    const {scrollTop, scrollHeight, clientHeight} = document.documentElement;
    //구조분해할당 destructurize
    if(scrollTop+clientHeight >= scrollHeight){ //전체 높이보다 더 스크롤을 내리면 로딩 함수 보여줘
        showLoading()
    }
});

function filterPosts(e){
    const val = e.target.value.toUpperCase(); //내가 입력한 값을 변수에 담고
    const posts = document.querySelectorAll('.post'); 
    posts.forEach(post => { //각각의 .post 에
        const title = post.querySelector('.post-title').innerText.toUpperCase();
        const body = post.querySelector('.post-body').innerText.toUpperCase();

        if(title.indexOf(val) > -1 || body.indexOf(val) > -1){
            post.style.display = 'flex';
        }else{
            post.style.display = 'none';
        }
    })
}
filter.addEventListener('input',filterPosts)
```
{% endraw %}


* [forEach 함수](https://bigtop.tistory.com/58)


** [setTimeOut()](https://www.daleseo.com/js-timer/)


*** [CORPS](https://hannut91.github.io/blogs/infra/cors)


**** [fetch()](https://www.daleseo.com/js-window-fetch/)


***** [fetch API 의 response interface](https://developer.mozilla.org/en-US/docs/Web/API/Response)


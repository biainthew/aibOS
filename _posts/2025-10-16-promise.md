---
layout: post
title: "Promise"
date: 2024-11-19
categories: [general]
tags: [Javascript/Jquery]
excerpt_separator: ""
---



Promise 는 비동기적으로 뭔가를 처리하기 위해서 사용


비동기적으로 처리해야 할 일이 뭐가 있는지 ?


=> 페이징 처리


맨 처음에 데이터 10개를 불러와두고 스크롤이 바닥에 닿으면 데이터를 10개 더 불러오라고 한다


데이터가 **있으면** 더 불러와서 페이지 만들어야 하니까 사용


쿼리에 rownum 사용해서 1-10, 11-20 이런식으로 불러올 수 있도록 해두고


데이터 다 쓸때까지 불러와서 페이지 만들기


```javascript
// 계약 데이터 조회하는 함수 호출(페이지 숫자, input 데이터) oRequestData 설정 하고 ajax 호출해서 성공하면
// oResponse.data = aData(계약서 데이터 배열)
contract_manage_list.fn_getContractData(contract_manage_list.nPage, oData).then(aData => {
    // aData가 빈 배열이 아니면
    if (aData.length > 0) {
        // 박스 페이지 추가하는 함수 호출
        contract_manage_list.fn_addBoxPage(contract_manage_list.nPage, aData);
    }
});
```


```javascript
/**
* 계약 데이터 조회
* @param {number} nPage - 페이지 번호
* @param {Object} oSearchData - 검색 조건 데이터
* @returns {Promise} 계약 데이터 Promise
*/
fn_getContractData(nPage, oSearchData = {}) {
  const oRequestData = {
      ...oSearchData,
      // rownum 이 1 and 1 * 10 / 11 and 20 ...
      pageNum: nPage,
      pageSize: contract_manage_list.pageSize
  };

  return new Promise((resolve, reject) => {
      $.ajax({
          type: 'POST',
          url: '/api/v1/doc/list',
          data: JSON.stringify(oRequestData),
          contentType: 'application/json',
          success: function(oResponse) {
              resolve(oResponse.data || []);
          },
          error: function(oError) {
              handleAjaxError(oError);
              reject(oError);
          }
      });
  });
}
```


```sql
WHERE RN BETWEEN (#{pageNum} - 1) * #{pageSize} + 1 AND #{pageNum} * #{pageSize}
```


---
layout: post
title: "배치(Batch)"
date: 2026-01-09
categories: [general]
tags: [Java]
---


### 배치 처리(Batch Processing)


데이터를 실시간으로 하나씩 처리하는 것이 아니라 일정량의 데이터를 모아서 한꺼번에 처리 하는 방식


**왜 하는가 ?**

- 어플리케이션과 DB 사이의 통신 횟수 감소
- DB 커넥션 점유 시간 감소, 트랜잭션 범위 최적화 -> 전체 처리량 증가
- 사용자가 적은 시간대에 대량의 연산 수행하여 서비스 안정성 확보

### 배치 조회(Batch Select / Fetch)


조회 성능을 높이는 핵심은 n + 1 문제를 해결하고 한 번에 필요한 만큼만 가져오는 것


**주요 기법**

- IN 절 활용 : 여러 개의 ID 를 하나의 쿼리로 묶어 조회
- Fetch Join : JPA 환경에서 연관된 엔티티를 한 번의 쿼리로 가져와 프록시 초기화 비용 제거
- Paging
    - Cursor : 마지막 본 데이터의 ID를 기준으로 다음 데이터를 조회하여 성능 유지
    - Offset : 대량 데이터 뒤쪽으로 갈수록 느려짐
- Fetch Size 조절 : JDBC 드라이버가 한 번에 메모리에 올릴 데이터 양을 설정하여 메모리 효율을 높임

### 배치 삽입(Batch Insert)


수천, 수만 건의 데이터를 INSERT 할 때 하나씩 수행하면 속도 느림


**주요 기법**

- Bulk Insert : `INSERT INTO table (col1) VALUES (val1), (val2), (val3)…` 처럼 하나의 쿼리에 여러 로우 포함
- JDBC Batch API : addBatch() 와 executeBatch() 를 사용하여 드라이버 수준에서 쿼리를 묶어 보냄

### 아키텍처 및 고려 사항


배치 프로세스를 설계할 때 반드시 고려해야 할 3요소

- Chunk Size : 한 번에 처리할 트랜잭션의 단위
- Idempotency(재진입성) : 오류로 인해 재실행했을 때 결과가 중복되거나 망가지지 않아야 함
- Logging & Monitoring : 성공/실패 건수, 처리 시간 등을 기록하여 장애에 대비
